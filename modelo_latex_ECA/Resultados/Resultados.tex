\chapter{Resultados}
 
%Ao longo do projeto algumas etapas se destacaram como de suma importância: análise de sistema existente, levantamento e registro de requisitos, elaboração da arquitetura do módulo, entendimento negocial dos índices a serem calculados

Anteriormente havia um módulo construído com propósito semelhante ao atual, entretanto, este começou a apresentar fragilidades à medida em que cresceram o número de clientes e malhas. Seu planejamento esperava um perfeito cadastro das entidades do sistema LOOP, assim apresentando problemas com frequência, comprometendo sua estabilidade.

O módulo citado não contemplava conceitos importantes para um software robusto, escalável e de boas condições para manutenção e evolução, como tratamento de exceções devidamente escolhido, \textit{logs} informativos e objetivos em relação a seu funcionamento, nem mesmo registro dos possíveis problemas ocorridos. Não menos importante, o módulo também não possuía documentação mínima de suas regras de negócio, dificultando sua manutenção ou evolução, além de manter o conhecimento do sistema somente na cabeça de seus criadores.

Tendo em vista o impacto dos pontos citados, além de um sistema funcionando plenamente de acordo com as regras de negócio desenhadas na etapa de levantamento de requisitos (\ref{sec:levantRequisitos}), apresentado a seguir na sub-seção Sistema em Produção, foram avaliados como resultados importantes outros itens também apresentados nessa seção: Documentação das regras de negócio e Condições de Manutenção do Software.


\section{Documentação de regras de negócio}

A documentação das regras de negócio de um sistema é de grande importância para sua manutenção e evolução. No início do projeto, ainda na etapa de levantamento de requisitos (\ref{sec:levantRequisitos}), foram elaborados os diagramas correspondentes à estrutura existente , figura \ref{fig:arqLoop} e ao fluxo de cálculos, figura \ref{fig:fluxoKpi}. Tais documentos são tradicionalmente utilizados para embasamento do desenvolvimento de um software. Entretanto, apesar de serem um ferramental para a elaboração de um software, no contexto do sistema existente, a elaboração deste documento foi considerada um resultado entregue. O documento elaborado contempla as seguintes informações:
\begin{itemize}
	\item \textbf{\textit{Overview} do sistema:} Descrição do \textit{Kpi-Executor}, seu fluxo de funcionamento, conforme descrito pela figura \ref{fig:fluxoKpi}, e os \textit{links} para os demais repositórios que compõem o sistema LOOP;
	\item \textbf{Arquitetura:} Possui uma breve descrição e diagrama que relaciona o \textit{Kpi-Executor} com os demais módulos, conforme figura \ref{fig:arqLoop}. Também possui informações sobre as bases de dados utilizadas pelo sistema LOOP, e suas relações com cada módulo;
	\item \textbf{\textit{Development:}} Possui informações para facilitação de integração de novos desenvolvedores ao time. Contempla passo a passo de instalação de dependências necessárias, etapas de configuração do sistema e diferentes formas de execução disponíveis;
	 
\end{itemize}

O documento citado foi adicionado junto ao repositório de códigos \textit{Gitlab} utilizado pelo time de \textit{Discovery} da \textit{IHM Stefanini}.

\section{Condições de Manutenção do Software}

A etapa de manutenção e evolução de um software é considerada a etapa mais cara de um processo de software \cite{engSw}. Dessa forma, a facilitação dessa etapa tem grande valia para um time de software. Ela consiste na resolução de possíveis \textit{bugs} que ocorram, além do atendimento de melhorias e evoluções do sistema.

A resolução de um \textit{bug} de um software se inicia pela constatação e réplica do problema relatado, seguidos da identificação da causa do problema e posteriormente o entendimento e a implementação da solução. Das etapas relatadas, a de identificação da causa se mostra das mais trabalhosas, quando tratamos de um sistema complexo. Para auxílio e facilitação desta etapa foram gerados os processos de registros de exceções do \textit{Kpi-Executor} (seção \ref{sec:regFalhasCalculo}).

Tais registros de falhas possibilitam ao desenvolvedor, através de baixo esforço, a identificação de um problema ocorrido no cálculo dos índices de performance de uma malha específica. Todas as falhas são registradas em banco de dados, com informações detalhadas da origem do problema. A figura \ref{fig:registroFalhas} traz um exemplo dessa identificação.

\begin{figure}[!htbp]
	\centering		
	\includegraphics[width=16cm]{Metodologia/Figuras/registroFalhas.png}
	\caption{Registro de Falhas - Logs}
	\label{fig:registroFalhas}
\end{figure}

Em destaque:
\begin{enumerate}
	\item Identificação do nome da malha que apresentou falhas no cálculo de seus índices de performance;
	\item Identificação de cliente a quem a malha pertence;
	\item Detalhamento do problema quando este não é uma exceção prevista no conjunto de \textit{Exceções de Fluxo} ou \textit{Exceções de Cálculo}  (seção \ref{sec:regFalhasCalculo});
	\item Identificação de tipo de exceção. Nessa coluna são registradas as previstas no fluxo do sistema, mas também as geradas por outros motivos.
	\item Registro de quando a falha ocorreu.
\end{enumerate}

Com esses registros em banco de dados, a investigação de possíveis problemas relacionados ao \textit{Kpi-executor} pode ser feita de forma orientada à falha, sendo possível a busca pelo nome da malha (presente na coluna \textit{message}), tipo de falha (coluna \textit{exception}) ou até mesmo por ciclo de execução (coluna \textit{timestamp}).


\section{Estabilização do Sistema}
\label{sec:estabilizacaoSistema}
Considerando a estrutura existente, descrita na seção \ref{sec:estruturaExistente}, a avaliação de estabilidade do sistema só pôde ser realizada após a garantia de uma boa integração aos demais módulos, em conjunto ao correto funcionamento cíclico, bem como a obtenção dos \textit{KPIs} de forma correta, como demonstrado pela seção \ref{sec:validacaoQA}. A entrega de um módulo (\textit{Kpi-Executor}) com caráter estável foi dos resultados mais importantes para o sistema LOOP como um todo, gerando mais confiança tanto aos usuários do sistema, quanto ao time responsável pela manutenção e evolução do sistema LOOP.

Para a avaliação da estabilidade do sistema foi utilizado o orquestrador de \textit{containers} \textit{Kubernetes} \cite{kubePage}. Tal estrutura configurada pelo time de \textit{DevOps} do setor \textit{Discovery} da \textit{IHM Stefanini}, além de garantir a disponibilidade dos módulos do sistema LOOP e integrar fluxos de CI/CD, permite também a observação do funcionamento individual de cada módulo.

O \textit{Kpi-Executor} foi estruturado com sua execução como \textit{Job} no orquestrador de \textit{containers}. Esse tipo de execução consiste em disparos cíclicos de uma instância do código escolhido. Na ferramenta também é possível avaliar o estado de \textit{sucesso} ou \textit{insucesso} de cada instância gerada.

Em detalhe:
\begin{enumerate}
	\item Lista de nomes dos \textit{jobs} executados junto ao estado da execução;
	\item Tempo desde a execução daquela instância de \textit{Kpi-Executor}
\end{enumerate}

\begin{figure}[!htbp]
	\centering		
	\includegraphics[width=14cm]{Resultados/Figuras/kubeExecCiclico.png}
	\caption{Status Execuções - Kubernetes}
	\label{fig:jobs}
\end{figure}
\newpage

Estão sempre disponíveis junto ao orquestrador de \textit{containers} os dados das últimas vinte e quatro execuções dos \textit{jobs} do \textit{Kpi-Executor}, bem como outras informações pertinentes à estabilidade do sistema LOOP. A figura \ref{fig:jobsPie} traz tais dados.

\begin{figure}[!htbp]
	\centering		
	\includegraphics[width=14cm]{Resultados/Figuras/jobsPie.png}
	\caption{Histórico Execuções - Kubernetes}
	\label{fig:jobsPie}
\end{figure}
Tendo em detalhes:
\begin{enumerate}
	\item Uso de CPU e Memória da máquina que hospeda o sistema;
	\item As últimas vinte e quatro execuções dos \textit{jobs} de \textit{Kpi-Executor}, tendo todas em estado de sucesso;
\end{enumerate}

Com os dados exibidos tem-se uma avaliação positiva da estabilidade do \textit{Kpi-Executor}, este se mantendo com execuções consistentes, respeitando seu agendamento e não apresentando grandes problemas de indisponibilidade ou falhas de execução.
	
